$(document).ready(function() {
  var paper = Raphael(10, 50, 800, 600),
      $go = $('#go'),
      car = paper.image($('#car').attr('src'), 500, 200, 300, 200);

  $('#car').hide();
  stoplight();
  //squiggle();

  car.click(function() {
    var x = car.attrs['x'];
    if (x >= 500 / 2) {
      car.animate({x: 0 }, 1000, 'elastic');
      window.setTimeout(function() {
        car.animate({x: 500 }, 1000, '');
      }, 700);
    }
  });

  function squiggle() {
    var p = paper.path("m326,65c0,1 0,2 0,3c0,1 1,2 2,2c1,0 3,0 4,0c1,0 2.46497,-0.84484 3,0c196.48749,310.26709 -50,339 -5,339c38,0 72.05219,1.6777 99,0c24.14005,-1.5029 79.33194,-49.26236 86,-111c4.72974,-43.79074 -10.22604,-76.71562 -49,-157c-35.6109,-73.73508 -68.94342,-162.96373 -123,-189c-152.32596,-73.36758 -122.14842,88.71411 -82,152c32.09247,50.5873 54.11621,85.64072 71,108c8.5647,11.34224 19.47125,22.45877 26,24c2.91974,0.68927 5.85114,0.51468 8,-4c3.54401,-7.44582 7.95862,-37.09737 5,-82c-4.50977,-68.44459 -0.2373,-143.59144 -32,-177c-20.72821,-21.80231 -12.19861,38.46559 3,93c20.4458,73.36191 42.48819,183.89832 56,250c12.45053,60.90964 76.88382,164.92426 88,148c9.89703,-15.06815 15.3327,-23.7283 24,-31c9.35132,-7.84558 21.59167,-14.43857 32,-26c18.07733,-20.08008 33.75256,-50.76068 42,-78c6.60809,-21.82504 11.49969,-41.97324 12,-56c0.24951,-6.99554 0.08167,-14.11215 -4,-17c-5.88672,-4.16495 -15.91638,-6.28247 -29,-10c-22.86462,-6.4967 -47,-12 -74,-19c-27,-7 -59.8511,-15.95749 -89,-20c-18.92386,-2.62445 -51,-3 -66,-3c-19,0 -40.32684,2.16524 -54,8c-14.39648,6.14342 -28.7202,17.51259 -38,32c-8.6972,13.57788 -18.44925,31.836 -23,45c-4.44394,12.85501 -8.49756,25.92578 -9,31c-0.49269,4.97568 -0.39415,8.01947 0,12c0.50244,5.07422 8.50394,15.70715 31,55c15.34631,26.80469 20.33936,68.07172 49,85c114.77835,67.79327 155.3873,-10.64767 169,-26c16.47958,-18.58557 27.12115,-30.90143 45,-53c12.08228,-14.93384 24.99243,-31.19806 31,-49c4.57813,-13.56616 5.4162,-30.00577 5,-45c-0.50018,-18.02081 -11.8009,-42.13464 -22,-57c-23.54465,-34.31689 -55.56598,-76.42314 -78,-99c-31.40384,-31.60379 -62.31348,-63.91375 -90,-84c-36.14413,-26.22216 -72.70624,-40.28331 -105,-47c-29.77658,-6.19315 -46.98792,-5.49994 -78,-6c-11.99844,-0.19347 -31.91183,1.23542 -41,13c-14.49265,18.76068 -19.87684,41.76146 -26,66c-3.50681,13.88172 -8,43 -8,68c0,14 -1.4649,34.31165 2,47c2.83725,10.38991 6.96404,16.02644 18,31c19.93515,27.04791 38.25381,55.50427 54,78c14.33606,20.48114 31.32976,38.13971 46,46c15.39386,8.24799 34.73975,14.97449 63,22c32.73779,8.13864 66.72586,15.49332 101,18c28.92276,2.1153 59.72809,2.99725 82,-4c15.7919,-4.9614 36.52252,-17.664 46,-30c13.37549,-17.40967 25.82184,-49.5564 33,-83c8.0733,-37.61411 8,-70 8,-105c0,-25 -7.901,-58.53697 -22,-86c-32.51645,-63.33784 -115.00253,-223.26294 -204,-131c-30.67322,31.79866 6.2406,69.14629 12,97c3.53632,17.10246 7.38202,30.19151 12,44c4.41757,13.20927 16.20633,43.30504 25,65c11.93826,29.45297 21.08826,48.60735 32,64c7.40613,10.44745 11.59311,14.47552 20,16c10.82349,1.96268 25.47333,1.13602 41,-6c20.73984,-9.532 41.78375,-24.38664 63,-36c20.79504,-11.38278 35.94855,-17.14951 59,-25c23.94751,-8.15567 45.5661,-14.88893 66,-26c26.82013,-14.5836 42.54492,-31.56612 52,-44c9.57062,-12.58584 15.46552,-22.83809 17,-28c1.45294,-4.88763 1.91901,-9.107 1,-13c-1.02747,-4.3525 -7.94629,-10.11984 -19,-15c-6.96698,-3.0759 -20.86249,-6.55966 -32,-9c-11.88361,-2.60381 -23,-3 -34,-3c-11,0 -22,0 -37,0c-13,0 -36.00726,-0.09025 -49,1c-22.01337,1.84718 -44.10364,4.52601 -68,10c-24.11404,5.52386 -68.85669,25.26471 -89,36c-30.78632,16.40742 -53.60883,26.08629 -72,39c-9.33118,6.55205 -19.31143,15.77563 -25,24c-7.41699,10.72327 -8,16 -10,24l0,4l0,2l0,2");
     p.animate({x: 0}, 400, 'bounce');
  }

  function stoplight() {
    var stoplightBar = 'm60,127c0,1 0.18835,3.94366 1,7c1.30875,4.92821 3.09882,10.98827 4,19c1.12335,9.98689 1.93839,19.00706 3,28c0.94519,8.00667 2.49875,14.94672 3,22c0.35443,4.98743 1.49875,11.94672 2,19c0.28357,3.98993 0.49875,9.94672 1,17c0.49622,6.98239 0,13 0,19c0,7 0,13 0,17c0,5 0,10 0,14c0,3 1,6 1,9c0,2 0,4 0,6c0,3 0,6 0,9c0,4 0,6 0,7c0,1 0,3 0,4c0,1 0,2 0,3c0,1 0,2 -1,3c-1,1 -2,1 -2,2c0,3 0,6 0,8c0,1 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3c0,1 0,2 0,3l0,1l0,1',
        stoplightHead = 'm36,17c0,1 0,2 0,3c0,1 0.18834,2.94366 1,6c1.30876,4.9282 1.50511,11.02045 2,17c0.50171,6.06203 2.49756,11.9258 3,17c0.39415,3.98053 1,8 1,12c0,2 0,5 0,7c0,2 0,4 0,6c0,3 0,5 0,8c0,2 0.49345,3.87856 1,7c0.48055,2.96126 1,6 1,8c0,2 0,3 0,5c0,1 0,2 0,3c0,1 0,2 0,3c0,2 0,3 0,5c0,1 -0.70711,2.29289 0,3c1.41422,1.41422 2,1 3,1c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 3,0 4,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 2,0 3,0c1,0 1.29291,-0.29289 2,-1c0.70709,-0.70711 2,0 2,-1c0,-1 0,-2 0,-5c0,-3 -0.32037,-6.02582 0,-8c0.50653,-3.12144 1.49347,-5.87856 2,-9c0.32037,-1.97418 1,-6 1,-8c0,-3 0,-5 0,-7c0,-3 0.4595,-5.0535 0,-7c-0.51373,-2.17625 -1,-4 -1,-6c0,-1 0.38269,-3.07612 0,-4c-1.0824,-2.61313 -1.5405,-4.0535 -2,-6c-0.51373,-2.17625 -1,-4 -2,-7c-1,-3 -2.49622,-4.90778 -3,-9c-0.24435,-1.98502 -0.23462,-5.15224 -1,-7c-0.5412,-1.30656 -1.48627,-1.82375 -2,-4c-0.22977,-0.97325 0,-2 0,-3c0,-2 0.4595,-4.0535 0,-6c-0.51373,-2.17625 -0.78986,-4.07844 -2,-7c-0.85571,-2.06586 -1,-4 -1,-5c0,-1 -0.4588,-1.69344 -1,-3c-0.38269,-0.92388 -0.07611,-2.38268 -1,-2c-1.30655,0.54119 -2,1 -3,1c-1,0 -2,0 -3,0c-1,0 -2,0 -4,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0c-1,0 -2,0 -3,0l-1,0l-1,0l-1,0',
        red = paper.circle(52, 32, 8.06226),
        yellow = paper.circle(55, 63, 8.48528),
        green = paper.circle(58, 98, 8.94427);

    paper.path(stoplightBar);
    paper.path(stoplightHead);
    var active_light = 'red';
    changeLight(red, yellow, green, active_light);
}

function changeLight(red, yellow, green, active_light) {
      var callback = function() { changeLight(red, yellow, green, active_light) };
      switch(active_light) {
        case 'red':
          active_light = 'green';
          red.attr({fill: '#ffffff'});
          yellow.attr({fill: '#ffffff'});
          green.attr({fill: '#007f00'});
          window.setTimeout(callback, 3000);
          break;
        case 'green':
          active_light = 'yellow';
          red.attr({fill: '#ffffff'});
          yellow.attr({fill: '#ffff00'});
          green.attr({fill: '#ffffff'});
          window.setTimeout(callback, 1000);
          break;
        case 'yellow':
          active_light = 'red';
          red.attr({fill: '#ff0000'});
          yellow.attr({fill: '#ffffff'});
          green.attr({fill: '#ffffff'});
          window.setTimeout(callback, 3000);
          break;
      }
  }
});
